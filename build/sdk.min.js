define("WS",[],function(){var e={options:{reconnectInterval:2e3},lockReconnect:!1,wsObj:null,wsUrl:"",reconnect:function(e){if(!this.lockReconnect){this.lockReconnect=!0;var t=this;setTimeout(function(){t.createWebSocket(e),t.lockReconnect=!1},this.options.reconnectInterval)}},log:function(e){console.log(e)},createWebSocket:function(e){console.log("createWebSocket"),this.wsUrl=e;try{"WebSocket"in window?this.wsObj=new WebSocket(e):"MozWebSocket"in window?this.wsObj=new MozWebSocket(e):this.log("当前浏览器不支持websocket协议,建议使用现代浏览器"),this.initEventHandle()}catch(t){this.reconnect(e)}return this.wsObj},SendMessage:function(e){return this.wsObj.readyState==WebSocket.OPEN?(console.log("WebSocket Send",e),this.wsObj.send(e),!0):(console.log("WebSocket Not Ready"),!1)},initEventHandle:function(){self=this,this.wsObj.onclose=function(){self.log("onclose"),self.reconnect(self.wsUrl)},this.wsObj.onerror=function(e){self.log("onerror"),self.reconnect(self.wsUrl)},this.wsObj.onopen=function(){self.log("onopen"),self.heartCheck.start()},this.wsObj.onmessage=function(e){console.log("onmessage",e.data),self.heartCheck.reset(),e.data&&self.OnMessage&&self.OnMessage(e.data)}},OnMessage:null,heartCheck:{timeout:6e4,timeoutObj:null,serverTimeoutObj:null,reset:function(){clearTimeout(this.timeoutObj),clearTimeout(this.serverTimeoutObj),this.start()},start:function(){var t=this;this.timeoutObj=setTimeout(function(){e.wsObj.send("{'cmd':'Ping'}"),t.serverTimeoutObj=setTimeout(function(){e.wsObj.close()},t.timeout)},this.timeout)}}};return e}),define("Utils",[],function(){return Date.prototype.Format=function(e){var t=e,n=["日","一","二","三","四","五","六"];return t=t.replace(/yyyy|YYYY/,this.getFullYear()),t=t.replace(/yy|YY/,this.getYear()%100>9?(this.getYear()%100).toString():"0"+this.getYear()%100),t=t.replace(/MM/,this.getMonth()>9?this.getMonth().toString():"0"+this.getMonth()),t=t.replace(/M/g,this.getMonth()),t=t.replace(/w|W/g,n[this.getDay()]),t=t.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate()),t=t.replace(/d|D/g,this.getDate()),t=t.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours()),t=t.replace(/h|H/g,this.getHours()),t=t.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes()),t=t.replace(/m/g,this.getMinutes()),t=t.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds()),t=t.replace(/s|S/g,this.getSeconds()),t=t.replace(/u|U/g,(this.getMilliseconds()/1e3+"00000").substring(2,5))},{enumMap:{},EnumMapRegister:function(e,t){this.enumMap[t]={collection:e,reverse:[]};for(var n in e)this.enumMap[t].reverse[e[n]]=n},EnumGetKey:function(e,t){var n=this.enumMap[e].reverse[t];return void 0===n?n:n.replace(e,"")},EnumGetValue:function(e,t){return this.enumMap[e].collection[(e+t).toUpperCase()]},now:function(){return(new Date).Format("HH:mm:ss.u")},containGetKey:function(e,t){for(var n in e)if(e[n]==t)return n;return!1},extend:function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.uber=t.prototype},extendOptions:function(e,t){for(var n in t)if("function"!=typeof t[n])if(t[n]instanceof Object)for(var o in t[n])if("function"!=typeof t[n][o])if(t[n][o]instanceof Object)for(var r in t[n][o])e[n]=e[n]?e[n]:{},e[n][o]=e[n][o]?e[n][o]:{},e[n][o][r]=t[n][o][r];else e[n]=e[n]?e[n]:{},e[n][o]=t[n][o];else e[n][o]=t[n][o];else e[n]=t[n];else e[n]=t[n];return e},getRandomNum4:function(){for(var e=""+Math.floor(1e4*Math.random());e.length<4;)e="0"+e;return e},getSequence:function(){for(var e=""+Math.floor(1e3*Math.random());e.length<3;)e="0"+e;var t=this.timestamp()+"";return t.substring(0,3)+t.substring(6)+e},timestamp:function(){return parseInt((new Date).valueOf()/1e3)},loadProtoFile:function(e){var t=ProtoBuf.loadProtoFile(e);return t.build()},loadProtoString:function(e){var t=ProtoBuf.loadProto(e);return t.build()},ten2sixteen:function(e){return[e>>8,255&e]},hex2IntArray:function(e){e.length%2&&(e+="0");for(var t=[],n=0;n<e.length;n+=2){var o=e.substr(n,2);t[n/2]=parseInt(o,16)}return t},intArray2HexStr:function(e){for(var t="",n=0;n<e.length;n++){var o=parseInt(e[n]).toString(16);1==o.length&&(o="0"+o),t+=o}return t},getOptionOrDefault:function(e,t,n){return e?void 0===e[t]?n:e[t]:n},HOTP:function(e,t){for(var n=sjcl.codec.base32.toBits(e),o=[(0xffffffff00000000&t)>>32,4294967295&t],r=6,i=new sjcl.misc.hmac(n,sjcl.hash.sha1),s=i.encrypt(o),a=15&sjcl.bitArray.extract(s,152,8),c=8*a,u=c+32,l=sjcl.bitArray.bitSlice(s,c,u),f=l[0],p=2147483647&f,d=p%Math.pow(10,r),m=d.toString();m.length<r;)m="0"+m;return m},base32_encode:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",n=e.length,o="",r=0,i=0,s=0;s<n;s++){for(var a=e.charCodeAt(s),c=r<<8|a,u=i+8;u>=5;)o+=t.charAt(c>>u-5),u-=5,c&=Math.pow(2,u)-1;r=c,i=u}return i>0&&(r<<=5-i,o+=t.charAt(r)),o},array_reverse:function(e){var t=[];for(var n in e)t[e[n]]=n;return t},ajax:function(e){e=e||{},e.method=(e.method||"GET").toUpperCase(),e.dataType=e.dataType||"json",e.async=void 0===e.async||e.async;var t=this.formatParams(e.data);if(window.XMLHttpRequest)var n=new XMLHttpRequest;else var n=new ActiveXObject("Microsoft.XMLHTTP");n.onreadystatechange=function(){if(4==n.readyState){var t=n.status;if(t>=200&&t<300)if("json"==e.dataType){var o=!1;try{var o=JSON.parse(n.responseText)}catch(e){o=!1}!1===o?e.success&&e.success(n.responseText,n.responseXML):e.success&&e.success(o,n)}else e.success&&e.success(n.responseText,n.responseXML);else e.fail&&e.fail(t)}},"GET"==e.method?(n.open("GET",e.url+"?"+t,e.async),n.send(null)):"POST"==e.method&&(n.open("POST",e.url,e.async),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(t))},formatParamsRecursively:function(e,t){var n=[],o="";for(var r in e)"object"==typeof e[r]?(o=t?t+"["+r+"]":r,n=n.concat(this.formatParamsRecursively(e[r],o))):t?n.push(encodeURIComponent(t+"["+r+"]")+"="+encodeURIComponent(e[r])):n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return n},formatParams:function(e){var t=[];return t=this.formatParamsRecursively(e,""),t.push(("v="+Math.random()).replace(".","")),t.join("&")},validateCallback:function(e){return void 0!==e&&"function"==typeof e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},fireFunction:function(e,t){return!(!e||!this.isFunction(e))&&e.apply("",t)},array_get:function(e,t,n){var o,r=e;o="object"==typeof t&&t instanceof Array?t:t.indexOf(".")!=-1?t.split("."):[t];for(var i in o){if(void 0==r[o[i]])return n;r=r[o[i]]}return r}}}),define("Logger",["Utils"],function(e){return{logLevel:"debug",setLevel:function(e){this.logLevel=e},debug:function(){this.log("debug",arguments)},info:function(){this.log("info",arguments)},notice:function(){this.log("notice",arguments)},warning:function(){this.log("warning",arguments)},error:function(){this.log("error",arguments)},levelCompare:function(e,t){var n={debug:1,info:2,notice:3,warning:4,error:5};return!(!n[t]||!n[e])&&n[t]>=n[e]},log:function(t,n){if(n.length>0&this.levelCompare(this.logLevel,t)){var o,r={debug:"grey",info:"green",notice:"blue",warning:"orange",error:"red"},i="%c["+e.now()+"] "+t+":";o=new Array,o.push(i),o.push("font-weight:bold;color: "+r[t]);for(var s in n)o.push(n[s]);return console.log.apply(console,o)}}}}),define("Proto",[],function(){var e={Cmd_VideoInfo:"VideoInfo",Cmd_PlaySmell:"PlaySmell",Cmd_StopPlay:"StopPlay",Cmd_PlayScript:"PlayScript",Cmd_ScriptJump:"ScriptJump",Cmd_ScriptPause:"ScriptStop",Cmd_ScriptContinue:"ScriptContinue",Cmd_ScriptStop:"ScriptStop"},t={getParameterName:function(e){if("object"==typeof e||"function"==typeof e){const t=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/=[^,)]+/gm,o=/=>.*$/gm;var r=e.prototype?e.prototype.constructor.toString():e.toString();r=r.replace(t,"").replace(o,"").replace(n,"");var i=r.slice(r.indexOf("(")+1,r.indexOf(")")).match(/([^\s,]+)/g);return null===i?[]:i}},AssembleProto:function(e,t){var n={cmd:e};return t&&(n.params=t),JSON.stringify(n)},AssembleProtoAuto:function(e,t,n){var o={cmd:e};if(n&&t&&n.length>0&&t.length>0){o.params={};for(var r=0;r<n.length;r++)o.params[t[r]]=n[r]}return JSON.stringify(o)},Cmd_VideoInfo:function(t,n,o){return this.AssembleProtoAuto(e.Cmd_VideoInfo,["url","name","length"],arguments)},Cmd_PlaySmell:function(t,n,o){return this.AssembleProtoAuto(e.Cmd_PlaySmell,["smell","duration","channel"],arguments)},Cmd_StopPlay:function(t){return this.AssembleProtoAuto(e.Cmd_StopPlay,["channel"],arguments)},Cmd_PlayScript:function(t,n){return this.AssembleProtoAuto(e.Cmd_PlayScript,["start","script_id"],arguments)},Cmd_ScriptJump:function(t){return this.AssembleProtoAuto(e.Cmd_ScriptJump,["start"],arguments)},Cmd_ScriptPause:function(){return this.AssembleProtoAuto(e.Cmd_ScriptPause)},Cmd_ScriptContinue:function(){return this.AssembleProtoAuto(e.Cmd_ScriptContinue)},Cmd_ScriptStop:function(){return this.AssembleProtoAuto(e.Cmd_ScriptStop)}};return t}),define("SDK",["WS","Utils","Logger","Proto"],function(e,t,n,o){var r,i,s,a={obj:null,tag:"",Ready:function(){return!!this.obj},CurrentTime:function(){return parseInt(1e3*this.obj.currentTime)},Duration:function(){return parseInt(1e3*this.obj.duration)}},c=window.location.host;if(c.indexOf("iqiyi")>-1)r="#flashbox video",i=".qy-player-side-head .head-title",s=".header-link",a.tag="iqiyi";else{if(!(c.indexOf("youku")>-1))return;r="#ykPlayer video",a.tag="youku",s="#left-title-content-wrap .subtitle"}e.createWebSocket("ws://127.0.0.1:38950/SmellPlayer");var u=document.querySelector(r);if(u)a.obj=u;else var l=setInterval(function(){u=document.querySelector(r),console.log(a.tag,f,"video=",u),u&&(a.obj=u,clearInterval(l))},2e3);var f=document.querySelector(s).innerHTML;console.log(a.tag,f,"video=",u);var p=!1,d=!1,m=0,h=0,g=2e3;e.OnMessage=function(t){if(console.log("data",t),t=JSON.parse(t),"scriptjump"==t.cmd.toString().toLowerCase()&&102==t.code)if(m){var n=a.CurrentTime();h=n,e.SendMessage(o.Cmd_PlayScript(n,m)),d=!0}else console.log("Jump Failed","Script Not Played"),d=!1;t&&0==t.code&&t.cmd&&"videoinfo"==t.cmd.toString().toLowerCase()&&(console.log("Get Script And Play"),m=parseInt(t.msg),e.SendMessage(o.Cmd_PlayScript(a.Duration(),m)),d=!0)};var S=setInterval(function(){if(a.Ready()){if(!p&&u.duration>900)return p=!0,e.SendMessage(o.Cmd_VideoInfo(window.location.href,f,a.Duration())),void clearInterval(S);p&&d&&e.SendMessage(o.Cmd_ScriptJump(a.CurrentTime())),console.log("video pos=",f,a.CurrentTime(),"/",a.Duration())}},1e4),v=1;setInterval(function(){if(a.Ready()&&p&&d){var t=parseInt(1e3*u.currentTime);(v%10==0||Math.abs(t-g-h)>100)&&(console.log("video Jump =",h,"/",a.Duration(),"=>",t," / ",a.Duration()),e.SendMessage(o.Cmd_ScriptJump(t))),v++,h=t}},g);return{ws:e,utils:t,logger:n}}),require(["SDK"],function(e){return console.log("this is main"),e}),define("../build/SDK-compress",function(){});